name: Publish

# Controls when the action will run. 
on:
  release:
    types: [published]


  workflow_dispatch:


jobs:
  # This workflow contains a single job called "build"
  puplish:
    if: "!github.event.release.prerelease"
    runs-on: ubuntu-latest
    
    steps:
      
      - name: Cache npm packages
        uses: actions/cache@v2.1.3
        with:
          path: ~/.npm
          key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}
          restore-keys: |
            ${{ runner.os }}-node-
            
      - run: npm ci
      - run: npm run build
        
      - name: Zip the build artifacts
        run: zip -r ./dist.zip ./dist
        
      - name: Extension upload
        uses: Klemensas/chrome-extension-upload-action@v1.3
        with:
          refresh-token: ${{ secrets.WEB_STORE_REFRESH_TOKEN }}
          client-id: ${{ secrets.WEB_STORE_CLIENT_ID }}
          client-secret: ${{ secrets.WEB_STORE_SECRET }}
          file-name: './dist.zip'
          app-id: 'bmpafkghbmojppjoeienibieljacdoaj'
          publish: true
